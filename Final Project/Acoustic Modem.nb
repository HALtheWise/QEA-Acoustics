(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 10.4' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[     24781,        772]
NotebookOptionsPosition[     21327,        644]
NotebookOutlinePosition[     21667,        659]
CellTagsIndexPosition[     21624,        656]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell["Comms final project: Acoustic Modem", "Title",
 CellChangeTimes->{{3.6826813785335817`*^9, 3.682681379590159*^9}, {
  3.682710876474948*^9, 3.682710892530466*^9}, {3.682980932118884*^9, 
  3.682980953632352*^9}, {3.6832870653509636`*^9, 3.6832870854599743`*^9}, {
  3.6832873288913145`*^9, 3.6832873404404697`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"SetDirectory", "@", 
   RowBox[{"NotebookDirectory", "[", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"<<", "\"\<../MMA library.m\>\""}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.682710916634346*^9, 3.682710945444784*^9}, {
  3.682711378657494*^9, 3.682711389969411*^9}}],

Cell[CellGroupData[{

Cell["Shared constants", "Section",
 CellChangeTimes->{{3.6832875389373174`*^9, 3.6832875420816317`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Global`databaud", " ", "=", " ", 
    TemplateBox[{"10","\"Hz\"","hertz","\"Hertz\""},
     "Quantity"]}], ";"}], 
  RowBox[{"(*", " ", "hertz", " ", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Global`speakerbaud", " ", "=", " ", 
   TemplateBox[{"40000","\"Hz\"","hertz","\"Hertz\""},
    "Quantity"]}], ";", 
  RowBox[{"(*", " ", "hertz", " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{"Global`carrierfreq", "=", 
   TemplateBox[{"500","\"Hz\"","hertz","\"Hertz\""},
    "Quantity"]}], ";", 
  RowBox[{"(*", " ", "hertz", " ", "*)"}]}]}], "Input",
 CellChangeTimes->{{3.683287543924816*^9, 3.683287605911014*^9}, {
  3.6832876485882816`*^9, 3.683287702112633*^9}, {3.6832877420886307`*^9, 
  3.683287760777499*^9}, {3.683414587589601*^9, 3.6834146002358656`*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"symbolBases", "=", 
  RowBox[{
   RowBox[{
    RowBox[{"Exp", "[", 
     RowBox[{"#", " ", "I"}], "]"}], "&"}], "/@", 
   RowBox[{"{", 
    RowBox[{"0", ",", "Pi"}], "}"}]}]}]], "Input",
 CellChangeTimes->{{3.6834148897008066`*^9, 3.6834149143338065`*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"1", ",", 
   RowBox[{"-", "1"}]}], "}"}]], "Output",
 CellChangeTimes->{3.683414944873807*^9}]
}, Open  ]],

Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.6834149429858065`*^9, 3.6834149480218067`*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["Transmitter", "Section",
 GeneratedCell->True,
 CellAutoOverwrite->True,
 CellChangeTimes->{3.683287430332458*^9}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"context", "=", "\"\<tx`\>\""}], "}"}], ",", 
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"Context", "[", "]"}], " ", "\[NotEqual]", " ", "context"}], 
      ",", 
      RowBox[{"Begin", "[", "context", "]"}]}], "]"}]}], "]"}], ";", 
  RowBox[{"Dynamic", "[", 
   RowBox[{"Refresh", "[", 
    RowBox[{
     RowBox[{"Context", "[", "]"}], ",", 
     RowBox[{"UpdateInterval", "\[Rule]", "1"}]}], "]"}], "]"}]}]], "Input",
 GeneratedCell->True,
 CellAutoOverwrite->True,
 CellChangeTimes->{3.683287430333458*^9}],

Cell[BoxData[
 DynamicBox[ToBoxes[
   Refresh[
    Context[], UpdateInterval -> 1], StandardForm],
  ImageSizeCache->{49., {0., 9.}}]], "Output",
 CellChangeTimes->{{3.6832874303354588`*^9, 3.683287437226147*^9}, 
   3.683288976625736*^9, 3.6832902466271305`*^9, {3.6832902850881305`*^9, 
   3.6832902897141304`*^9}, 3.6832910728252954`*^9, 3.683414763539194*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell["Step 1: Generate signal codes", "Subsection",
 CellChangeTimes->{{3.6832874303384585`*^9, 3.683287485779002*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"codeLen", "=", 
   RowBox[{"speakerbaud", "/", "databaud"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.6832878412795486`*^9, 3.683287864545875*^9}}],

Cell["\<\
The codes are still complex at this point, and will only be transformed to \
real space before being played.\
\>", "Text",
 CellChangeTimes->{{3.68328790299572*^9, 3.6832879282152414`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"baseCode", " ", "=", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"Exp", "[", 
      RowBox[{"I", " ", "2", "Pi", " ", 
       RowBox[{"QuantityMagnitude", "@", "carrierfreq"}], " ", "#"}], "]"}], 
     "&"}], "/@", 
    RowBox[{"N", "@", 
     RowBox[{
      RowBox[{"Range", "[", 
       RowBox[{"0", ",", 
        RowBox[{"1", "/", 
         RowBox[{"QuantityMagnitude", "@", "databaud"}]}], ",", 
        RowBox[{"1", "/", 
         RowBox[{"QuantityMagnitude", "@", "speakerbaud"}]}]}], "]"}], "[", 
      RowBox[{"[", 
       RowBox[{";;", 
        RowBox[{"-", "2"}]}], "]"}], "]"}]}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"codes", "=", 
   RowBox[{
    RowBox[{
     RowBox[{"baseCode", "*", "#"}], "&"}], "/@", "symbolBases"}]}], 
  ";"}]}], "Input",
 CellChangeTimes->{{3.6832878230457253`*^9, 3.6832878254189625`*^9}, {
  3.6832878906134815`*^9, 3.6832878932117414`*^9}, {3.683287933052725*^9, 
  3.68328805851427*^9}, {3.683288105199736*^9, 3.683288144851736*^9}, {
  3.6832881842847357`*^9, 3.683288212465736*^9}, {3.6832882879867363`*^9, 
  3.6832883277047358`*^9}, {3.683288991190736*^9, 3.683289062324736*^9}, {
  3.6832891202340417`*^9, 3.683289162335251*^9}, {3.683414646026444*^9, 
  3.683414664204262*^9}, {3.683414959578807*^9, 3.6834149645038066`*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["Step 2: Retrieve data to transmit", "Subsection",
 CellChangeTimes->{{3.6832874694333677`*^9, 3.683287494997924*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"rawdata", "=", "\"\<a-z\>\""}], ";"}]], "Input",
 CellChangeTimes->{{3.6832892655645733`*^9, 3.6832892844914656`*^9}, {
  3.6832895381278267`*^9, 3.683289538285843*^9}, {3.6832902531881304`*^9, 
  3.6832902545311303`*^9}, {3.6832903065661306`*^9, 3.6832903105971303`*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["Step 3: Convert data to symbols", "Subsection",
 CellChangeTimes->{{3.683287497098134*^9, 3.683287505773001*^9}}],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"bytes", "=", 
   RowBox[{"ToCharacterCode", "@", "rawdata"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"symbols", "=", 
   RowBox[{"Flatten", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"IntegerDigits", "[", 
       RowBox[{"#", ",", "2", ",", "8"}], "]"}], "&"}], "/@", "bytes"}], 
    "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"Append", "[", 
  RowBox[{
   RowBox[{"symbols", "[", 
    RowBox[{"[", 
     RowBox[{"1", ";;", "10"}], "]"}], "]"}], ",", "\"\<...\>\""}], 
  "]"}]}], "Input",
 CellChangeTimes->{{3.6832892901300297`*^9, 3.683289317486765*^9}, {
  3.683289426920707*^9, 3.6832895837293863`*^9}, {3.6832910644384565`*^9, 
  3.6832910645254655`*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
  "0", ",", "1", ",", "1", ",", "0", ",", "0", ",", "0", ",", "0", ",", "1", 
   ",", "0", ",", "0", ",", "\<\"...\"\>"}], "}"}]], "Output",
 CellChangeTimes->{{3.6832894888539*^9, 3.6832895843164454`*^9}, {
   3.6832902467861304`*^9, 3.68329028523213*^9}, 3.6832903180231304`*^9, {
   3.6832910651065235`*^9, 3.6832910729583087`*^9}, 3.6834147636812086`*^9}]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Step 4: Interleave transmit codes", "Subsection",
 CellChangeTimes->{{3.683287508639288*^9, 3.6832875153889627`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"signal", "=", 
   RowBox[{"Flatten", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"codes", "[", 
       RowBox[{"[", 
        RowBox[{"#", "+", "1"}], "]"}], "]"}], "&"}], "/@", "symbols"}], 
    "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.6832896041284266`*^9, 3.683289647049718*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["Step 5: Transmit and save", "Subsection",
 CellChangeTimes->{{3.683287517913215*^9, 3.6832875221366377`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"sound", "=", 
   RowBox[{"SampledSoundList", "[", 
    RowBox[{
     RowBox[{"Re", "@", "signal"}], ",", 
     RowBox[{"QuantityMagnitude", "@", "speakerbaud"}]}], "]"}]}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.6832898991129217`*^9, 3.6832899723882484`*^9}, 
   3.6832902355581303`*^9}],

Cell[BoxData[
 RowBox[{"EmitSound", "[", "sound", "]"}]], "Input",
 CellChangeTimes->{{3.683289654034416*^9, 3.6832897266566777`*^9}, {
  3.6832899750975194`*^9, 3.683289998117821*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Export", "[", 
  RowBox[{"\"\<test data\\output.wav\>\"", ",", "sound"}], "]"}]], "Input",
 CellChangeTimes->{{3.6832898427072816`*^9, 3.683289843642375*^9}, {
  3.6832900052395334`*^9, 3.683290039747984*^9}},
 EmphasizeSyntaxErrors->True],

Cell[BoxData["\<\"test data\\\\output.wav\"\>"], "Output",
 CellChangeTimes->{{3.6832900199470043`*^9, 3.6832900402130303`*^9}, {
   3.6832902469721303`*^9, 3.68329031818513*^9}, 3.68329107317433*^9, 
   3.6834147639332333`*^9}]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Cleanup", "Subsection",
 CellChangeTimes->{{3.6832897656275744`*^9, 3.6832897685428658`*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"context", "=", "\"\<tx`\>\""}], "}"}], ",", 
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"Context", "[", "]"}], "\[Equal]", "context"}], ",", 
     RowBox[{"End", "[", "]"}], ",", "\"\<Not in context\>\""}], "]"}]}], 
  "]"}]], "Input",
 GeneratedCell->True,
 CellAutoOverwrite->True,
 CellChangeTimes->{3.6832874303394585`*^9}],

Cell[BoxData["\<\"tx`\"\>"], "Output",
 CellChangeTimes->{3.6832910731873317`*^9, 3.6834147639432344`*^9}]
}, Open  ]]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Receiver", "Section",
 CellChangeTimes->{{3.6832903627421303`*^9, 3.68329037494013*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"context", "=", "\"\<rx`\>\""}], "}"}], ",", 
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"Context", "[", "]"}], " ", "\[NotEqual]", " ", "context"}], 
      ",", 
      RowBox[{"Begin", "[", "context", "]"}]}], "]"}]}], "]"}], ";", 
  RowBox[{"Dynamic", "[", 
   RowBox[{"Refresh", "[", 
    RowBox[{
     RowBox[{"Context", "[", "]"}], ",", 
     RowBox[{"UpdateInterval", "\[Rule]", "1"}]}], "]"}], "]"}]}]], "Input",
 GeneratedCell->True,
 CellAutoOverwrite->True,
 CellChangeTimes->{3.6832903627431307`*^9, 3.6834151196178064`*^9}],

Cell[BoxData[
 DynamicBox[ToBoxes[
   Refresh[
    Context[], UpdateInterval -> 1], StandardForm],
  ImageSizeCache->{21., {0., 9.}}]], "Output",
 CellChangeTimes->{{3.6832903627451305`*^9, 3.6832903838611307`*^9}, {
   3.6832910819862113`*^9, 3.6832911038403964`*^9}, 3.6834143519800425`*^9, 
   3.6834147692217627`*^9, 3.6834151212738066`*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell["Read in the audio data", "Subsection",
 CellChangeTimes->{{3.6832904035551305`*^9, 3.6832904137781305`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"inputSound", "=", 
   RowBox[{"Import", "[", 
    RowBox[{"\"\<test data/output.wav\>\"", ",", "\"\<Data\>\""}], "]"}]}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.6832904165821304`*^9, 3.6832905281511307`*^9}, {
  3.68329059660713*^9, 3.6832906875771303`*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["Find the agreed-upon start code, then crop to it", "Subsection",
 CellChangeTimes->{{3.6832906927401304`*^9, 3.6832907166431303`*^9}}],

Cell["TODO: do this", "Text",
 CellChangeTimes->{{3.6832907504331303`*^9, 3.68329075445413*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"croppedsound", "=", "inputSound"}], ";"}]], "Input",
 CellChangeTimes->{{3.6832907371151304`*^9, 3.6832907570971303`*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["Chop the sound into databaud long segments", "Subsection",
 CellChangeTimes->{{3.68329072004613*^9, 3.68329073225813*^9}}],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"segments", "=", 
   RowBox[{"Partition", "[", 
    RowBox[{"croppedsound", ",", 
     RowBox[{"speakerbaud", "/", "databaud"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"Dimensions", "@", "segments"}]}], "Input",
 CellChangeTimes->{{3.6832908368191304`*^9, 3.6832908400091305`*^9}, {
  3.6832908783591304`*^9, 3.68329096201313*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"24", ",", "4000"}], "}"}]], "Output",
 CellChangeTimes->{{3.6832909150691304`*^9, 3.68329096240913*^9}, {
   3.6832910820682197`*^9, 3.68329110617563*^9}, 3.6834143627151155`*^9, 
   3.683414769310771*^9, 3.6834151296198063`*^9}]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["For each segment, identify the most likely symbol", "Subsection",
 CellChangeTimes->{{3.6832911735743694`*^9, 3.683291175832595*^9}, {
  3.683291257619773*^9, 3.6832912587618876`*^9}, {3.683414321962041*^9, 
  3.6834143364884934`*^9}}],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"baseCode", " ", "=", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"Exp", "[", 
      RowBox[{"I", " ", "2", "Pi", " ", 
       RowBox[{"QuantityMagnitude", "@", "carrierfreq"}], " ", "#"}], "]"}], 
     "&"}], "/@", 
    RowBox[{"N", "@", 
     RowBox[{
      RowBox[{"Range", "[", 
       RowBox[{"0", ",", 
        RowBox[{"1", "/", 
         RowBox[{"QuantityMagnitude", "@", "databaud"}]}], ",", 
        RowBox[{"1", "/", 
         RowBox[{"QuantityMagnitude", "@", "speakerbaud"}]}]}], "]"}], "[", 
      RowBox[{"[", 
       RowBox[{";;", 
        RowBox[{"-", "2"}]}], "]"}], "]"}]}]}]}], ";"}], "\n", 
 RowBox[{"Length", "@", "baseCode"}]}], "Input",
 CellChangeTimes->{{3.683414683570198*^9, 3.683414685202361*^9}, 
   3.683414744076248*^9}],

Cell[BoxData["4000"], "Output",
 CellChangeTimes->{
  3.683414512892132*^9, 3.683414688236665*^9, {3.683414745455386*^9, 
   3.683414769388779*^9}, 3.6834151325658064`*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"ratios", "=", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"2", "/", 
      RowBox[{"(", 
       RowBox[{"Length", "@", "baseCode"}], ")"}]}], 
     RowBox[{"Dot", "[", 
      RowBox[{"baseCode", ",", "#"}], "]"}]}], "&"}], "/@", 
   "segments"}]}]], "Input",
 CellChangeTimes->{{3.6834143907749214`*^9, 3.6834144378266263`*^9}, {
  3.6834144920780506`*^9, 3.6834145024670897`*^9}, {3.6834147264744883`*^9, 
  3.6834147309609365`*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"0.9999785817091127`", "\[VeryThinSpace]", "-", 
    RowBox[{"6.127635945289526`*^-15", " ", "\[ImaginaryI]"}]}], ",", 
   RowBox[{
    RowBox[{"-", "0.9999785817091129`"}], "+", 
    RowBox[{"6.1261052840651735`*^-15", " ", "\[ImaginaryI]"}]}], ",", 
   RowBox[{
    RowBox[{"-", "0.9999785817091129`"}], "+", 
    RowBox[{"6.1261052840651735`*^-15", " ", "\[ImaginaryI]"}]}], ",", 
   RowBox[{"0.9999785817091127`", "\[VeryThinSpace]", "-", 
    RowBox[{"6.127635945289526`*^-15", " ", "\[ImaginaryI]"}]}], ",", 
   RowBox[{"0.9999785817091127`", "\[VeryThinSpace]", "-", 
    RowBox[{"6.127635945289526`*^-15", " ", "\[ImaginaryI]"}]}], ",", 
   RowBox[{"0.9999785817091127`", "\[VeryThinSpace]", "-", 
    RowBox[{"6.127635945289526`*^-15", " ", "\[ImaginaryI]"}]}], ",", 
   RowBox[{"0.9999785817091127`", "\[VeryThinSpace]", "-", 
    RowBox[{"6.127635945289526`*^-15", " ", "\[ImaginaryI]"}]}], ",", 
   RowBox[{
    RowBox[{"-", "0.9999785817091129`"}], "+", 
    RowBox[{"6.1261052840651735`*^-15", " ", "\[ImaginaryI]"}]}], ",", 
   RowBox[{"0.9999785817091127`", "\[VeryThinSpace]", "-", 
    RowBox[{"6.127635945289526`*^-15", " ", "\[ImaginaryI]"}]}], ",", 
   RowBox[{"0.9999785817091127`", "\[VeryThinSpace]", "-", 
    RowBox[{"6.127635945289526`*^-15", " ", "\[ImaginaryI]"}]}], ",", 
   RowBox[{
    RowBox[{"-", "0.9999785817091129`"}], "+", 
    RowBox[{"6.1261052840651735`*^-15", " ", "\[ImaginaryI]"}]}], ",", 
   RowBox[{"0.9999785817091127`", "\[VeryThinSpace]", "-", 
    RowBox[{"6.127635945289526`*^-15", " ", "\[ImaginaryI]"}]}], ",", 
   RowBox[{
    RowBox[{"-", "0.9999785817091129`"}], "+", 
    RowBox[{"6.1261052840651735`*^-15", " ", "\[ImaginaryI]"}]}], ",", 
   RowBox[{
    RowBox[{"-", "0.9999785817091129`"}], "+", 
    RowBox[{"6.1261052840651735`*^-15", " ", "\[ImaginaryI]"}]}], ",", 
   RowBox[{"0.9999785817091127`", "\[VeryThinSpace]", "-", 
    RowBox[{"6.127635945289526`*^-15", " ", "\[ImaginaryI]"}]}], ",", 
   RowBox[{
    RowBox[{"-", "0.9999785817091129`"}], "+", 
    RowBox[{"6.1261052840651735`*^-15", " ", "\[ImaginaryI]"}]}], ",", 
   RowBox[{"0.9999785817091127`", "\[VeryThinSpace]", "-", 
    RowBox[{"6.127635945289526`*^-15", " ", "\[ImaginaryI]"}]}], ",", 
   RowBox[{
    RowBox[{"-", "0.9999785817091129`"}], "+", 
    RowBox[{"6.1261052840651735`*^-15", " ", "\[ImaginaryI]"}]}], ",", 
   RowBox[{
    RowBox[{"-", "0.9999785817091129`"}], "+", 
    RowBox[{"6.1261052840651735`*^-15", " ", "\[ImaginaryI]"}]}], ",", 
   RowBox[{
    RowBox[{"-", "0.9999785817091129`"}], "+", 
    RowBox[{"6.1261052840651735`*^-15", " ", "\[ImaginaryI]"}]}], ",", 
   RowBox[{
    RowBox[{"-", "0.9999785817091129`"}], "+", 
    RowBox[{"6.1261052840651735`*^-15", " ", "\[ImaginaryI]"}]}], ",", 
   RowBox[{"0.9999785817091127`", "\[VeryThinSpace]", "-", 
    RowBox[{"6.127635945289526`*^-15", " ", "\[ImaginaryI]"}]}], ",", 
   RowBox[{
    RowBox[{"-", "0.9999785817091129`"}], "+", 
    RowBox[{"6.1261052840651735`*^-15", " ", "\[ImaginaryI]"}]}], ",", 
   RowBox[{"0.9999785817091127`", "\[VeryThinSpace]", "-", 
    RowBox[{"6.127635945289526`*^-15", " ", "\[ImaginaryI]"}]}]}], 
  "}"}]], "Output",
 CellChangeTimes->{
  3.6834145057574186`*^9, 3.6834146901178527`*^9, {3.6834147313349743`*^9, 
   3.6834147694027805`*^9}, {3.6834151125558066`*^9, 3.6834151343528066`*^9}}]
}, Open  ]],

Cell["\<\
TODO: Correct for drift in phase space with clever snapping algorithms.\
\>", "Text",
 CellChangeTimes->{{3.6834153407428064`*^9, 3.6834153575588064`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"bestSymbol", "[", "ratio_", "]"}], ":=", "\[IndentingNewLine]", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "differences", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"differences", "=", 
      RowBox[{"Abs", "[", 
       RowBox[{"ratio", "-", "symbolBases"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"Ordering", "[", 
        RowBox[{"differences", ",", "1"}], "]"}], "[", 
       RowBox[{"[", "1", "]"}], "]"}], "-", "1"}]}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.6834148477378063`*^9, 3.6834148512398067`*^9}, {
  3.683414975505807*^9, 3.6834150668108063`*^9}, {3.6834151501128063`*^9, 
  3.6834151501928062`*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"symbols", "=", 
  RowBox[{"bestSymbol", "/@", "ratios"}]}]], "Input",
 CellChangeTimes->{{3.683415094920807*^9, 3.6834151063858066`*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
  "0", ",", "1", ",", "1", ",", "0", ",", "0", ",", "0", ",", "0", ",", "1", 
   ",", "0", ",", "0", ",", "1", ",", "0", ",", "1", ",", "1", ",", "0", ",", 
   "1", ",", "0", ",", "1", ",", "1", ",", "1", ",", "1", ",", "0", ",", "1", 
   ",", "0"}], "}"}]], "Output",
 CellChangeTimes->{{3.683415108099807*^9, 3.6834151542588067`*^9}}]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Convert the symbols back into text", "Subsection",
 CellChangeTimes->{{3.683415170276807*^9, 3.6834151780278063`*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"bytes", "=", 
  RowBox[{
   RowBox[{
    RowBox[{"FromDigits", "[", 
     RowBox[{"#", ",", "2"}], "]"}], "&"}], "/@", 
   RowBox[{"Partition", "[", 
    RowBox[{"symbols", ",", "8"}], "]"}]}]}]], "Input",
 CellChangeTimes->{{3.6834151808318067`*^9, 3.6834151931428065`*^9}, {
  3.683415230505807*^9, 3.683415249979807*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"97", ",", "45", ",", "122"}], "}"}]], "Output",
 CellChangeTimes->{3.6834152517018065`*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"output", "=", 
  RowBox[{"FromCharacterCode", "@", "bytes"}]}]], "Input",
 CellChangeTimes->{{3.683415292361807*^9, 3.6834152989448066`*^9}}],

Cell[BoxData["\<\"a-z\"\>"], "Output",
 CellChangeTimes->{3.683415299276807*^9}]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Cleanup", "Subsection",
 CellChangeTimes->{{3.6832905377471304`*^9, 3.68329054079613*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"context", "=", "\"\<rx`\>\""}], "}"}], ",", 
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"Context", "[", "]"}], "\[Equal]", "context"}], ",", 
     RowBox[{"End", "[", "]"}], ",", "\"\<Not in context\>\""}], "]"}]}], 
  "]"}]], "Input",
 GeneratedCell->True,
 CellAutoOverwrite->True,
 CellChangeTimes->{3.6832903627491302`*^9}],

Cell[BoxData["\<\"rx`\"\>"], "Output",
 CellChangeTimes->{{3.6832903627521305`*^9, 3.6832903816691303`*^9}, 
   3.6832910820772204`*^9, 3.6834147694127817`*^9}]
}, Open  ]]
}, Open  ]]
}, Open  ]]
}, Open  ]]
},
WindowSize->{942, 962},
WindowMargins->{{0, Automatic}, {Automatic, 0}},
FrontEndVersion->"11.0 for Microsoft Windows (64-bit) (July 28, 2016)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[580, 22, 321, 4, 101, "Title"],
Cell[904, 28, 331, 7, 66, "Input",
 InitializationCell->True],
Cell[CellGroupData[{
Cell[1260, 39, 105, 1, 70, "Section"],
Cell[1368, 42, 824, 18, 112, "Input"],
Cell[CellGroupData[{
Cell[2217, 64, 280, 8, 30, "Input"],
Cell[2500, 74, 134, 4, 30, "Output"]
}, Open  ]],
Cell[2649, 81, 96, 1, 30, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[2782, 87, 120, 3, 70, "Section"],
Cell[CellGroupData[{
Cell[2927, 94, 625, 19, 50, "Input"],
Cell[3555, 115, 363, 7, 30, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[3955, 127, 119, 1, 49, "Subsection"],
Cell[4077, 130, 182, 4, 30, "Input"],
Cell[4262, 136, 199, 4, 30, "Text"],
Cell[4464, 142, 1330, 33, 69, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[5831, 180, 123, 1, 49, "Subsection"],
Cell[5957, 183, 307, 5, 30, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[6301, 193, 119, 1, 49, "Subsection"],
Cell[CellGroupData[{
Cell[6445, 198, 723, 21, 69, "Input"],
Cell[7171, 221, 399, 7, 30, "Output"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[7619, 234, 123, 1, 49, "Subsection"],
Cell[7745, 237, 326, 10, 30, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[8108, 252, 115, 1, 49, "Subsection"],
Cell[8226, 255, 325, 9, 30, "Input"],
Cell[8554, 266, 185, 3, 30, "Input"],
Cell[CellGroupData[{
Cell[8764, 273, 263, 5, 30, "Input"],
Cell[9030, 280, 228, 3, 30, "Output"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[9307, 289, 99, 1, 49, "Subsection"],
Cell[CellGroupData[{
Cell[9431, 294, 426, 13, 30, "Input"],
Cell[9860, 309, 106, 1, 30, "Output"]
}, Open  ]]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[10027, 317, 94, 1, 70, "Section"],
Cell[CellGroupData[{
Cell[10146, 322, 651, 19, 50, "Input"],
Cell[10800, 343, 345, 7, 30, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[11182, 355, 114, 1, 49, "Subsection"],
Cell[11299, 358, 296, 7, 30, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[11632, 370, 140, 1, 49, "Subsection"],
Cell[11775, 373, 96, 1, 30, "Text"],
Cell[11874, 376, 157, 3, 30, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[12068, 384, 128, 1, 49, "Subsection"],
Cell[CellGroupData[{
Cell[12221, 389, 381, 9, 50, "Input"],
Cell[12605, 400, 269, 5, 30, "Output"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[12923, 411, 241, 3, 49, "Subsection"],
Cell[CellGroupData[{
Cell[13189, 418, 786, 22, 69, "Input"],
Cell[13978, 442, 172, 3, 30, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[14187, 450, 464, 13, 30, "Input"],
Cell[14654, 465, 3387, 66, 130, "Output"]
}, Open  ]],
Cell[18056, 534, 165, 3, 30, "Text"],
Cell[18224, 539, 762, 19, 107, "Input"],
Cell[CellGroupData[{
Cell[19011, 562, 161, 3, 30, "Input"],
Cell[19175, 567, 376, 7, 30, "Output"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[19600, 580, 124, 1, 49, "Subsection"],
Cell[CellGroupData[{
Cell[19749, 585, 348, 9, 30, "Input"],
Cell[20100, 596, 131, 3, 30, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[20268, 604, 165, 3, 30, "Input"],
Cell[20436, 609, 80, 1, 30, "Output"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[20565, 616, 96, 1, 49, "Subsection"],
Cell[CellGroupData[{
Cell[20686, 621, 426, 13, 30, "Input"],
Cell[21115, 636, 160, 2, 30, "Output"]
}, Open  ]]
}, Open  ]]
}, Open  ]]
}, Open  ]]
}
]
*)

